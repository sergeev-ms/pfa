<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/screen/window.xsd"
        caption="msg://accountEdit.caption" focusComponent="form"
        messagesPack="com.borets.pfa.web.screens.account">
    <data>
        <instance id="accountDc" class="com.borets.pfa.entity.account.Account">
            <view extends="_local">
                <property name="customer"/>
                <property name="parent" view="_minimal"/>
                <property name="actualRevision" view="_local">
                    <property name="manager"/>
                    <property name="createdBy"/>
                    <property name="createTs"/>
                </property>
                <property name="actualMarketDetail" view="_local">
                    <property name="createdBy"/>
                    <property name="createTs"/>
                </property>
                <property name="actualAppDetail" view="_minimal">
                    <property name="account"/>
                    <property name="yearMonth"/>
                    <property name="systemAllocations" view="_local">
                        <property name="system" view="_local">
                            <property name="pumpModel" view="_minimal"/>
                            <property name="depth" view="_minimal"/>
                            <property name="motorType" view="_minimal"/>
                            <property name="intakeConfig" view="_minimal"/>
                            <property name="vaproConfig" view="_minimal"/>
                            <property name="sealConfig" view="_minimal"/>
                            <property name="pumpConfig" view="_minimal"/>
                            <property name="pumpMaterials" view="_minimal"/>
                            <property name="sealMaterials" view="_minimal"/>
                            <property name="motorMaterials" view="_minimal"/>
                        </property>
                    </property>
                    <property name="createdBy"/>
                    <property name="createTs"/>
                </property>
                <property name="actualEquipmentUtilization" view="_local">
                    <property name="account" view="_minimal">
                        <property name="country" view="_minimal"/>
                    </property>
                    <property name="details" view="_local">
                        <property name="equipmentType" view="_minimal"/>
                        <property name="values" view="_local" fetch="UNDEFINED"/>
                    </property>
                    <property name="createdBy"/>
                    <property name="createTs"/>
                </property>
                <property name="country" view="_minimal"/>
                <property name="projects" view="_local">
                    <property name="project" view="_minimal"/>
                </property>
            </view>
            <loader id="accountDl"/>
            <instance id="actualRevisionDc" property="actualRevision"/>
            <instance id="marketDataDc" property="actualMarketDetail"/>
            <instance id="applicationDataDc" property="actualAppDetail"/>
            <instance id="equipmentUtilizationDc" property="actualEquipmentUtilization"/>
            <collection id="projectsDc" property="projects"/>
        </instance>
        <collection id="priceListsDc" class="com.borets.pfa.entity.price.PriceList">
            <view extends="_local">
                <property name="createTs"/>
            </view>
            <loader id="priceListsDl">
                <query>where e.account = :container_accountDc order by e.createTs desc</query>
            </loader>
        </collection>
        <collection id="directSalesDc" class="com.borets.pfa.entity.account.directsale.DirectSale">
            <view extends="_local">
                <property name="createTs"/>
                <property name="parent"/>
            </view>
            <loader id="directSalesDl">
                <query>where e.account = :container_accountDc order by e.createTs desc</query>
            </loader>
        </collection>
        <collection id="activityPlansDc" class="com.borets.pfa.entity.activity.Activity">
            <view extends="_local">
                <property name="createTs"/>
            </view>
            <loader id="activityPlansDl">
                <query>where e.account = :container_accountDc order by e.createTs desc</query>
            </loader>
        </collection>
        <instance id="supplementaryDc" class="com.borets.pfa.entity.account.supplementary.Supplementary">
            <loader id="supplementaryDl">
                <query>where e.account = :container_accountDc</query>
            </loader>
            <view extends="_minimal">
                <property name="details" view="_local">
                    <property name="type"/>
                </property>
            </view>
        </instance>
        <collection id="countryOptionsDc" class="com.borets.addon.country.entity.Country">
            <loader id="countryOptionsDl">
                <query>select e from country_Country e order by e.name</query>
            </loader>
        </collection>
        <collection id="equipmentUtilizationDetailValueDc"
                    class="com.borets.pfa.entity.account.utilization.EquipmentUtilizationDetailValue">
            <view extends="_local">
                <property name="detail" view="_minimal"/>
                <property name="valueType" view="_minimal"/>
            </view>
            <loader id="equipmentUtilizationDetailValueDl">
                <query>
                    select e from pfa_EquipmentUtilizationDetailValue e where
                    e.detail.equipmentUtilization = :actualEquipmentUtilization
                </query>
            </loader>
        </collection>
        <collection id="projectsOptionDc" class="com.borets.pfa.entity.project.Project">
            <loader id="projectsOptionDl"/>
        </collection>
    </data>
    <dialogMode height="600" width="800"/>
    <layout expand="tabSheet" spacing="false">
        <label id="screenHeader" stylename="h2 bold colored" align="MIDDLE_CENTER"/>
        <tabSheet id="tabSheet">
            <tab id="generalTab" caption="msg://generalTab.caption" spacing="true" margin="true,false,false,false"
                 expand="marketDataGb">
                <groupBox id="accountDataGb" caption="msg://accountDataGb.caption" spacing="true">
                    <form id="form" dataContainer="accountDc" childrenCaptionWidth="170px" width="100%">
                        <column width="100%">
                            <lookupField id="countryField" property="country" optionsContainer="countryOptionsDc"/>
                            <pickerField id="parentField" property="parent">
                                <actions>
                                    <action id="open" type="picker_open"/>
                                    <action id="clear" type="picker_clear"/>
                                    <action id="lookup" type="picker_lookup"/>
                                </actions>
                            </pickerField>
                            <textField id="nameField" property="name"/>
                            <pickerField property="customer"/>
                        </column>
                        <column width="100%">
                            <lookupField property="contractType"/>
                            <lookupField property="applicationType"/>
                            <lookupField property="fieldType" required="false"/>
                        </column>
                        <column width="100%">
                            <textField id="typeField" property="type" editable="false"
                                       dataContainer="actualRevisionDc"/>
                            <textField id="managerField" property="manager" editable="false"
                                       dataContainer="actualRevisionDc"/>
                            <checkBox id="activeField" property="active" editable="false"
                                       dataContainer="actualRevisionDc"/>
                        </column>
                    </form>
                    <hbox spacing="true" align="MIDDLE_RIGHT">
                        <linkButton id="createRevisionBtn" caption="msg://createRevisionBtn.caption"
                                    icon="CREATE_ACTION"/>
                        <linkButton id="showRevisionsBtn" caption="msg://showRevisionsBtn.caption" icon="HISTORY"/>
                    </hbox>
                </groupBox>
                <groupBox id="marketDataGb" caption="msg://marketDataGb.caption" spacing="true"
                          expand="marketDataFragment">
                    <fragment id="marketDataFragment" screen="pfa_MarketDataFragment"/>
                    <hbox spacing="true" align="MIDDLE_RIGHT">
                        <linkButton id="createMarketDataBtn" caption="msg://createMarketDataBtn.caption"
                                    icon="CREATE_ACTION"/>
                        <linkButton id="showMarketDetailsBtn" caption="msg://showMarketDetailsBtn.caption"
                                    icon="HISTORY"/>
                    </hbox>
                </groupBox>
            </tab>
            <tab id="appDataTab" caption="msg://appDataTab.caption" spacing="true"
                 margin="true,false,false,false" expand="appDataGb">
                <groupBox id="appDataGb" caption="msg://appDataGb.caption" spacing="true"
                          expand="applicationDataFragment">
                    <fragment id="applicationDataFragment" screen="pfa_ApplicationDataFragment"/>
                </groupBox>
                <hbox spacing="true" align="MIDDLE_RIGHT">
                    <linkButton id="createAppDataBtn" caption="msg://createAppDataBtn.caption" icon="CREATE_ACTION"/>
                    <linkButton id="showAppDetailsBtn" caption="msg://showAppDetailsBtn.caption" icon="HISTORY"/>
                </hbox>
            </tab>
            <tab id="utilizationTab" caption="msg://utilizationTab.caption" margin="true,false,false,false"
                 expand="equipmentUtilizationGb" spacing="true">
                <groupBox id="equipmentUtilizationGb" caption="msg://equipmentUtilizationGb.caption" spacing="true"
                          expand="equipmentUtilizationFragment">
                    <fragment id="equipmentUtilizationFragment" screen="pfa_EquipmentUtilizationFragment"/>
                </groupBox>
                <hbox spacing="true" align="MIDDLE_RIGHT">
                    <linkButton id="createUtilizationBtn" caption="msg://createUtilizationBtn.caption"
                                icon="CREATE_ACTION"/>
                    <linkButton id="showUtilizationsBtn" caption="msg://showUtiliazationsBtn.caption" icon="HISTORY"/>
                </hbox>
            </tab>
            <tab id="priceListsTab" caption="msg://priceListsTab.caption" expand="priceListsTable"
                 spacing="true" margin="true,false,false,false">
                <table id="priceListsTable" dataContainer="priceListsDc" width="100%">
                    <columns>
                        <column id="recordType"/>
                        <column id="yearMonth"/>
                        <column id="createTs"/>
                    </columns>
                    <actions>
                        <action id="view" trackSelection="true" type="view"/>
                        <action id="create" type="create" icon="CREATE_ACTION"
                                caption="msg://priceListsTable.create.caption"/>
                    </actions>
                    <rowsCount/>
                </table>
                <linkButton id="createPriceListBtn" action="priceListsTable.create" align="MIDDLE_RIGHT"/>
            </tab>
            <tab id="activityPlansTab" caption="msg://activityPlansTab.caption" expand="activityPlansTable"
                 spacing="true" margin="true,false,false,false">
                <table id="activityPlansTable" dataContainer="activityPlansDc" width="100%">
                    <columns>
                        <column id="recordType"/>
                        <column id="yearMonth"/>
                        <column id="createTs"/>
                    </columns>
                    <actions>
                        <action id="view" trackSelection="true" caption="msg://activityPlansTable.view.caption"/>
                        <action id="create" type="create" icon="CREATE_ACTION"
                                caption="msg://activityPlansTable.create.caption"/>
                    </actions>
                    <rowsCount/>
                </table>
                <linkButton id="createActivityPlanBtn" action="activityPlansTable.create" align="MIDDLE_RIGHT"/>
            </tab>
            <tab id="directSalesTab" caption="msg://directSalesTab.caption" expand="directSalesTable"
                 spacing="true" margin="true,false,false,false">
                <treeTable id="directSalesTable" dataContainer="directSalesDc" width="100%" hierarchyProperty="parent">
                    <columns>
                        <column id="createTs"/>
                        <column id="recordType"/>
                        <column id="status"/>
                        <column id="date" caption="msg://directSalesTable.date"/>
                        <column id="probability"/>
                        <column id="bShare"/>
                    </columns>
                    <actions>
                        <action id="view" type="edit" trackSelection="true" caption="msg://directSalesTable.view.caption"/>
                        <action id="create" type="create" icon="CREATE_ACTION"
                                caption="msg://directSalesTable.create.caption"/>
                        <action id="addForecast" caption="msg://detailsTable.addForecast.caption"
                                trackSelection="true" icon="LINK" constraintOperationType="create"/>
                    </actions>
                    <rowsCount/>
                </treeTable>
                <hbox spacing="true" align="MIDDLE_RIGHT">
                    <linkButton id="createDirectSaleBtn" action="directSalesTable.create"/>
                    <linkButton id="addForecastBtn" action="directSalesTable.addForecast"/>
                </hbox>
            </tab>
            <tab id="supplementaryTab" caption="msg://supplementaryTab.caption" spacing="true"
                 margin="true,false,false,false" expand="attachmentFragment">
                <fragment id="supplementaryFragment" screen="pfa_SupplementaryFragment"/>
                <fragment id="attachmentFragment" screen="attachments_AttachmentsFragment"/>
            </tab>
            <tab id="projectsTab" caption="msg://projectsTab.caption" spacing="true"
                 margin="true,false,false,false" expand="projectContainer">
                <hbox id="projectContainer" width="100%" spacing="true">
                    <dataGrid id="projectOptionTable" dataContainer="projectsOptionDc" selectionMode="MULTI"
                              width="100%" height="100%" emptyStateMessage="msg://projectOptionTable.emptyStateMessage">
                        <columns>
                            <column property="well" sort="ASCENDING"/>
                            <column property="wellApi"/>
                            <column property="wellId" collapsed="true"/>
                            <column property="region" collapsed="true"/>
                        </columns>
                        <actions>
                            <action id="assignToAccount" trackSelection="true" icon="CHEVRON_RIGHT" caption="Assign"/>
                        </actions>
                        <buttonsPanel align="MIDDLE_RIGHT">
                            <button action="projectOptionTable.assignToAccount" stylename="icon-align-right"/>
                        </buttonsPanel>
                    </dataGrid>
                    <dataGrid id="assignedProjectsTable" dataContainer="projectsDc" selectionMode="MULTI"
                              height="100%" width="100%" settingsEnabled="false"
                              emptyStateMessage="msg://assignedProjectsTable.emptyStateMessage">
                        <columns>
                            <column property="project.well" sort="ASCENDING"/>
                            <column property="project.wellApi"/>
                            <column property="project.wellId" collapsed="true"/>
                            <column property="project.region" collapsed="true"/>
                            <column property="dateStart"/>
                            <column property="dateEnd"/>
                        </columns>
                        <actions>
                            <action id="removeAssign" caption="Remove Assign" icon="REMOVE" trackSelection="true"/>
                        </actions>
                        <buttonsPanel>
                            <button action="assignedProjectsTable.removeAssign"/>
                        </buttonsPanel>
                    </dataGrid>
                </hbox>
            </tab>
        </tabSheet>
        <hbox id="editActions" spacing="true">
            <button id="commitAndCloseBtn" action="windowCommitAndClose"/>
            <button id="windowCommitBtn" action="windowCommit"/>
            <button id="closeBtn" action="windowClose"/>
        </hbox>
    </layout>
</window>
